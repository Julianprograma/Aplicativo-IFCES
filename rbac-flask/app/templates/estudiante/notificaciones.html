{% extends 'layout.html' %}
{% block title %}Notificaciones - IFCES{% endblock %}
{% block content %}
<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="display-5">üîî Notificaciones</h1>
    <div>
      <span class="badge bg-danger me-2">{{ no_leidas }} sin leer</span>
      <a href="{{ url_for('main.dashboard_estudiante') }}" class="btn btn-outline-secondary">
        ‚Üê Volver
      </a>
    </div>
  </div>

  {% if notificaciones %}
    <div class="list-group">
      {% for notif in notificaciones %}
        <div class="list-group-item {% if not notif.leida %}notif-no-leida{% endif %}">
          <div class="d-flex w-100 justify-content-between align-items-start">
            <div>
              <div class="d-flex align-items-center mb-2">
                {% if notif.tipo == 'success' %}
                  <span class="badge bg-success me-2">‚úÖ</span>
                {% elif notif.tipo == 'warning' %}
                  <span class="badge bg-warning me-2">‚ö†Ô∏è</span>
                {% elif notif.tipo == 'danger' %}
                  <span class="badge bg-danger me-2">‚ùå</span>
                {% else %}
                  <span class="badge bg-info me-2">‚ÑπÔ∏è</span>
                {% endif %}
                <h5 class="mb-0">{{ notif.titulo }}</h5>
              </div>
              <p class="mb-2">{{ notif.mensaje }}</p>
              <small class="text-muted">
                {{ notif.fecha_creacion.strftime('%d/%m/%Y %H:%M') }}
              </small>
            </div>
            <div class="d-flex flex-column align-items-end">
              {% if not notif.leida %}
                <button class="btn btn-sm btn-primary mb-2" 
                        onclick="marcarLeida({{ notif.id }})">
                  Marcar como le√≠da
                </button>
              {% endif %}
              {% if notif.url_destino %}
                <a href="{{ notif.url_destino }}" class="btn btn-sm btn-outline-primary">
                  Ver m√°s
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">
      <i class="bi bi-info-circle"></i> No tienes notificaciones.
    </div>
  {% endif %}
</div>

<style>
.notif-no-leida {
  background-color: #f0f8ff;
  border-left: 4px solid #007bff;
  font-weight: 500;
}

.list-group-item {
  transition: all 0.3s;
}

.list-group-item:hover {
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
</style>

<script>
function marcarLeida(notifId) {
  fetch(`/estudiante/notificacion/${notifId}/marcar-leida`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      location.reload();
    }
  });
}
</script>
{% endblock %}

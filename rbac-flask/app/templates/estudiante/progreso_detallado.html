{% extends 'layout.html' %}
{% block title %}Progreso Detallado -ICFES{% endblock %}
{% block content %}
<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="display-5">üìà Progreso Detallado</h1>
    <a href="{{ url_for('main.dashboard_estudiante') }}" class="btn btn-outline-secondary">
      ‚Üê Volver al Dashboard
    </a>
  </div>

  <!-- Estad√≠sticas Generales -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="stat-card">
        <div class="stat-icon">üìä</div>
        <div class="stat-value">{{ "%.1f"|format(promedio_general) }}%</div>
        <div class="stat-label">Promedio General</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card">
        <div class="stat-icon">‚úÖ</div>
        <div class="stat-value">{{ examenes_aprobados }}</div>
        <div class="stat-label">Ex√°menes Aprobados</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card">
        <div class="stat-icon">üèÜ</div>
        <div class="stat-value">{{ "%.1f"|format(mejor_calificacion) }}%</div>
        <div class="stat-label">Mejor Calificaci√≥n</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card">
        <div class="stat-icon">üìù</div>
        <div class="stat-value">{{ total_examenes }}</div>
        <div class="stat-label">Total Ex√°menes</div>
      </div>
    </div>
  </div>

  <!-- Fortalezas y Debilidades -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-success text-white">
          <h4>üí™ Fortalezas</h4>
        </div>
        <div class="card-body">
          {% if fortalezas %}
            <ul class="list-group">
              {% for f in fortalezas %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <span>{{ f.icono }} {{ f.nombre }}</span>
                  <span class="badge bg-success">{{ "%.1f"|format(f.promedio) }}%</span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">Completa m√°s ex√°menes para ver tus fortalezas</p>
          {% endif %}
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-warning text-dark">
          <h4>‚ö†Ô∏è √Åreas de Mejora</h4>
        </div>
        <div class="card-body">
          {% if debilidades %}
            <ul class="list-group">
              {% for d in debilidades %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <span>{{ d.icono }} {{ d.nombre }}</span>
                  <span class="badge bg-warning">{{ "%.1f"|format(d.promedio) }}%</span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">¬°Excelente! No hay √°reas d√©biles identificadas</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Progreso por Categor√≠a -->
  <div class="card mb-4">
    <div class="card-header">
      <h4>üìö Rendimiento por Categor√≠a</h4>
    </div>
    <div class="card-body">
      {% if categorias_stats %}
        {% for cat, stats in categorias_stats.items() %}
          <div class="categoria-progress mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span>
                <span style="color: {{ stats.color }}">{{ stats.icono }}</span>
                <strong>{{ cat }}</strong>
              </span>
              <span>{{ "%.1f"|format(stats.promedio) }}%</span>
            </div>
            <div class="progress" style="height: 25px;">
              <div class="progress-bar" 
                   role="progressbar" 
                   style="width: {{ stats.promedio }}%; background-color: {{ stats.color }};"
                   aria-valuenow="{{ stats.promedio }}" 
                   aria-valuemin="0" 
                   aria-valuemax="100">
                {{ "%.0f"|format(stats.promedio) }}%
              </div>
            </div>
            <small class="text-muted">{{ stats.total }} ex√°menes completados</small>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-muted">Completa ex√°menes para ver tu progreso por categor√≠as</p>
      {% endif %}
    </div>
  </div>

  <!-- Progreso en el Tiempo -->
  <div class="card mb-4">
    <div class="card-header">
      <h4>üìä Progreso en el Tiempo</h4>
    </div>
    <div class="card-body">
      {% if progreso_tiempo %}
        <canvas id="progresoChart"></canvas>
      {% else %}
        <p class="text-muted">Completa m√°s ex√°menes para ver tu progreso en el tiempo</p>
      {% endif %}
    </div>
  </div>
</div>

<style>
.stat-card {
  background: white;
  border-radius: 10px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: transform 0.3s;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.stat-icon {
  font-size: 3em;
  margin-bottom: 10px;
}

.stat-value {
  font-size: 2em;
  font-weight: bold;
  color: #00695c;
}

.stat-label {
  color: #666;
  font-size: 0.9em;
}

.categoria-progress {
  padding: 15px;
  background: #f8f9fa;
  border-radius: 8px;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
{% if progreso_tiempo %}
const ctx = document.getElementById('progresoChart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: {{ progreso_tiempo | map(attribute='fecha') | list | tojson }},
    datasets: [{
      label: 'Calificaci√≥n',
      data: {{ progreso_tiempo | map(attribute='calificacion') | list | tojson }},
      borderColor: '#00695c',
      backgroundColor: 'rgba(0, 105, 92, 0.1)',
      tension: 0.4,
      fill: true
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: {
        display: true
      },
      tooltip: {
        callbacks: {
          afterLabel: function(context) {
            return 'Examen: ' + {{ progreso_tiempo | map(attribute='examen') | list | tojson }}[context.dataIndex];
          }
        }
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        max: 100,
        ticks: {
          callback: function(value) {
            return value + '%';
          }
        }
      }
    }
  }
});
{% endif %}
</script>
{% endblock %}

{% extends 'layout.html' %}
{% block title %}Resultados - {{ examen.titulo }}{% endblock %}
{% block content %}
<div class="dashboard-header">
  <h2>üìä Resultados del Examen</h2>
  <p class="welcome">{{ examen.titulo }}</p>
</div>

<div class="action-bar">
  <a href="{{ url_for('profesor.lista_examenes') }}" class="btn btn-secondary">‚Üê Volver a Ex√°menes</a>
</div>

<div class="stats-container">
  <div class="stat-card">
    <div class="stat-value">{{ resultados|length }}</div>
    <div class="stat-label">Estudiantes Presentaron</div>
  </div>
  
  <div class="stat-card">
    <div class="stat-value">{{ "%.2f"|format(promedio) }}</div>
    <div class="stat-label">Promedio General</div>
  </div>
  
  <div class="stat-card">
    <div class="stat-value">{{ aprobados }}</div>
    <div class="stat-label">Aprobados (‚â•60%)</div>
  </div>
  
  <div class="stat-card">
    <div class="stat-value">{{ resultados|length - aprobados }}</div>
    <div class="stat-label">Reprobados</div>
  </div>
</div>

{% if resultados %}
  <div class="table-container">
    <table class="results-table">
      <thead>
        <tr>
          <th>Estudiante</th>
          <th>Calificaci√≥n</th>
          <th>Total Puntos</th>
          <th>Porcentaje</th>
          <th>Estado</th>
          <th>Fecha Inicio</th>
          <th>Fecha Fin</th>
          <th>Tiempo</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for resultado in resultados %}
          <tr>
            <td>{{ resultado.estudiante.username }}</td>
            <td class="calificacion">{{ resultado.calificacion }}</td>
            <td>{{ resultado.total_puntos }}</td>
            <td>
              {% set porcentaje = (resultado.calificacion / resultado.total_puntos * 100) if resultado.total_puntos > 0 else 0 %}
              {{ "%.1f"|format(porcentaje) }}%
            </td>
            <td>
              {% if resultado.completado %}
                {% set porcentaje = (resultado.calificacion / resultado.total_puntos * 100) if resultado.total_puntos > 0 else 0 %}
                {% if porcentaje >= 60 %}
                  <span class="badge badge-success">Aprobado</span>
                {% else %}
                  <span class="badge badge-danger">Reprobado</span>
                {% endif %}
              {% else %}
                <span class="badge badge-warning">En progreso</span>
              {% endif %}
            </td>
            <td>{{ resultado.fecha_inicio.strftime('%d/%m/%Y %H:%M') if resultado.fecha_inicio }}</td>
            <td>{{ resultado.fecha_fin.strftime('%d/%m/%Y %H:%M') if resultado.fecha_fin else '-' }}</td>
            <td>
              {% if resultado.fecha_inicio and resultado.fecha_fin %}
                {% set duracion = resultado.fecha_fin - resultado.fecha_inicio %}
                {{ duracion.seconds // 60 }} min
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              <a href="{{ url_for('profesor.detalle_resultado', id=resultado.id) }}" 
                 class="btn btn-sm" 
                 style="background:#4caf50;color:#fff;" 
                 title="Ver detalle y comentar">
                üí¨ Comentar
              </a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="empty-state">
    <p>üì≠ Ning√∫n estudiante ha presentado este examen a√∫n</p>
  </div>
{% endif %}
{% endblock %}

{% extends 'layout.html' %}
{% block title %}Nueva Pregunta - {{ examen.titulo }}{% endblock %}
{% block content %}
<div class="dashboard-header">
  <h2>‚ûï Crear Pregunta</h2>
  <p class="welcome">{{ examen.titulo }}</p>
</div>

<form method="post" class="auth-form">
  <div class="form-group">
    <label for="texto">Enunciado de la pregunta *</label>
    <textarea name="texto" id="texto" rows="4" required class="form-control"></textarea>
  </div>

  <div class="form-group">
    <label for="tipo">Tipo de pregunta *</label>
    <select name="tipo" id="tipo" required class="form-control" onchange="cambiarTipoPregunta()">
      <option value="">Selecciona un tipo</option>
      <option value="opcion_multiple">Opci√≥n M√∫ltiple</option>
      <option value="verdadero_falso">Verdadero o Falso</option>
      <option value="abierta">Respuesta Abierta</option>
    </select>
  </div>

  <div class="form-row">
    <div class="form-group" style="width: 48%; display: inline-block;">
      <label for="puntos">Puntos *</label>
      <input type="number" name="puntos" id="puntos" min="1" value="5" required class="form-control">
    </div>

    <div class="form-group" style="width: 48%; display: inline-block; margin-left: 2%;">
      <label for="nivel_dificultad">Nivel de Dificultad üìä</label>
      <select name="nivel_dificultad" id="nivel_dificultad" class="form-control">
        <option value="basico">üü¢ B√°sico</option>
        <option value="intermedio">üü° Intermedio</option>
        <option value="avanzado">üî¥ Avanzado</option>
      </select>
    </div>
  </div>

  <div class="form-group">
    <label for="tiempo_estimado">Tiempo estimado (segundos) ‚è±Ô∏è</label>
    <input type="number" name="tiempo_estimado" id="tiempo_estimado" min="10" value="60" class="form-control">
    <small>Tiempo promedio que un estudiante necesita para responder</small>
  </div>

  <!-- Opciones para Opci√≥n M√∫ltiple -->
  <div id="opcion_multiple_section" style="display:none;">
    <div class="form-group">
      <label>Opciones de respuesta</label>
      <div id="opciones_container">
        <div class="opcion-item">
          <input type="text" name="opcion_1" placeholder="Opci√≥n 1" class="form-control" style="margin-bottom: 10px;">
        </div>
        <div class="opcion-item">
          <input type="text" name="opcion_2" placeholder="Opci√≥n 2" class="form-control" style="margin-bottom: 10px;">
        </div>
        <div class="opcion-item">
          <input type="text" name="opcion_3" placeholder="Opci√≥n 3" class="form-control" style="margin-bottom: 10px;">
        </div>
        <div class="opcion-item">
          <input type="text" name="opcion_4" placeholder="Opci√≥n 4" class="form-control" style="margin-bottom: 10px;">
        </div>
      </div>
      <button type="button" onclick="agregarOpcion()" class="btn btn-sm btn-secondary">+ Agregar opci√≥n</button>
    </div>
    
    <div class="form-group">
      <label for="respuesta_correcta_om">Respuesta correcta *</label>
      <select name="respuesta_correcta" id="respuesta_correcta_om" class="form-control">
        <option value="">Selecciona la opci√≥n correcta</option>
      </select>
    </div>
  </div>

  <!-- Opciones para Verdadero/Falso -->
  <div id="verdadero_falso_section" style="display:none;">
    <div class="form-group">
      <label>Respuesta correcta *</label>
      <div class="radio-group">
        <label class="radio-label">
          <input type="radio" name="respuesta_correcta" value="Verdadero">
          <span>Verdadero</span>
        </label>
        <label class="radio-label">
          <input type="radio" name="respuesta_correcta" value="Falso">
          <span>Falso</span>
        </label>
      </div>
    </div>
  </div>

  <!-- Opciones para Respuesta Abierta -->
  <div id="abierta_section" style="display:none;">
    <div class="form-group">
      <label for="respuesta_sugerida">Respuesta sugerida (opcional)</label>
      <textarea name="respuesta_correcta" id="respuesta_sugerida" rows="3" class="form-control" 
                placeholder="Escribe una respuesta modelo o criterios de evaluaci√≥n"></textarea>
    </div>
  </div>

  <!-- Explicaci√≥n (para todas las preguntas) -->
  <div class="form-group">
    <label for="explicacion">Explicaci√≥n de la respuesta correcta üí°</label>
    <textarea name="explicacion" id="explicacion" rows="3" class="form-control" 
              placeholder="Explica por qu√© esta es la respuesta correcta (se mostrar√° despu√©s de responder)"></textarea>
    <small>Esta explicaci√≥n ayudar√° a los estudiantes a aprender de sus errores</small>
  </div>

  <div class="form-actions">
    <a href="{{ url_for('profesor.gestionar_preguntas', id=examen.id) }}" class="btn btn-secondary">Cancelar</a>
    <button type="submit" class="btn btn-primary">Guardar Pregunta</button>
  </div>
</form>

<script>
let opcionCounter = 4;

function cambiarTipoPregunta() {
  const tipo = document.getElementById('tipo').value;
  
  // Ocultar todas las secciones
  document.getElementById('opcion_multiple_section').style.display = 'none';
  document.getElementById('verdadero_falso_section').style.display = 'none';
  document.getElementById('abierta_section').style.display = 'none';
  
  // Mostrar la secci√≥n correspondiente
  if (tipo === 'opcion_multiple') {
    document.getElementById('opcion_multiple_section').style.display = 'block';
    actualizarSelectRespuesta();
  } else if (tipo === 'verdadero_falso') {
    document.getElementById('verdadero_falso_section').style.display = 'block';
  } else if (tipo === 'abierta') {
    document.getElementById('abierta_section').style.display = 'block';
  }
}

function agregarOpcion() {
  opcionCounter++;
  const container = document.getElementById('opciones_container');
  const div = document.createElement('div');
  div.className = 'opcion-item';
  div.innerHTML = `<input type="text" name="opcion_${opcionCounter}" placeholder="Opci√≥n ${opcionCounter}" class="form-control" style="margin-bottom: 10px;" onchange="actualizarSelectRespuesta()">`;
  container.appendChild(div);
  actualizarSelectRespuesta();
}

function actualizarSelectRespuesta() {
  const select = document.getElementById('respuesta_correcta_om');
  select.innerHTML = '<option value="">Selecciona la opci√≥n correcta</option>';
  
  const inputs = document.querySelectorAll('#opciones_container input[type="text"]');
  inputs.forEach((input, index) => {
    if (input.value.trim() !== '') {
      const option = document.createElement('option');
      option.value = input.value;
      option.textContent = input.value;
      select.appendChild(option);
    }
  });
}

// Actualizar select cuando se escriben las opciones
document.addEventListener('DOMContentLoaded', function() {
  const inputs = document.querySelectorAll('#opciones_container input[type="text"]');
  inputs.forEach(input => {
    input.addEventListener('input', actualizarSelectRespuesta);
  });
});
</script>
{% endblock %}
